\chapter{Ekuazio garapenak.}
\label{eranskin:A}

\section{Kepler hasierako baliodun problema.}
\label{erans:A1}

Keplerren ekuazioa, kokapen eta abiadura berriak kalkulatzeko oinarrizkoa da eta era honetan definitzen da,
\begin{equation*}
E-e \ \sin E = M,
\end{equation*}
non $M=n \ (t-T)$ (\emph{mean anomaly}), $n=k \ a^{-3/2}$ (\emph{mean motion}) eta $T$, $M=0$ deneko integrazio konstantea da. $E$ (\emph{eccentric anomaly}) eta $t$-ren arteko erlazio hau erabiliz kalkulatzen da mugimendua. Mugimendu eliptikoaren kasura mugatuko gara ($0\leq e < 1)$ eta Keplerren ekuazioa transendentala denez, zenbakizko metodo baten bidez ebatziko dugu.

\subsection*{Garapena.}

Gure abiapuntua, honakoa da,
\begin{align*}
E_0-e \ \sin E_0 & =n \ (t_0-t_p), \\
E_1-e \ \sin E_1 & =n \ (t_1-t_p)
\end{align*}
non $n=2\pi/P$ eta $P$ periodoa diren.

\paragraph*{} Bi ekuazioen arteko kendura eginez,
\begin{equation*}
E_1-E_0-e \ (\sin(E_1)-\sin(E_0))=n \triangle t \ \ \ \longrightarrow \ \triangle E - e \ (\sin(E_0+\triangle E)-\sin(E_0))=n \triangle t
\end{equation*}
non $E_1=E_0+\triangle E$ den.  

\paragraph*{} Honako notazioa erabiliz adieraziko dugu,
\begin{equation*}
\triangle E - ce \ \sin(\triangle E- se \ (\cos(\triangle E)-1)=n \triangle t,
\end{equation*}
non $ce=e \ \cos(E_0)$ eta $se=e \ \sin(E_0)$ den.

\paragraph*{Newton metodoa.}Ekuazio ebazteko, Newton metodoa aplikatuko dugu,

\begin{enumerate}
\item $f(\triangle E)=\triangle E - ce \sin(\triangle E)- se (\cos(\triangle E)-1)-n \triangle t=0$.

\item $f'(\triangle E)=1-ce \cos(\triangle E)+ se \sin(\triangle E)$.

\item $\triangle E^{[k+1]}=\triangle E^{[k]}- \frac{f(\triangle E^{[k]})}{f'(\triangle E^{[k]})}$.

\end{enumerate}

\paragraph*{Hasierako balioa.} $\triangle E^{[0]}$ hasierako balioa, finkatzea da dugun zailtasun handiena. Horretarako honako garapena egingo dugu,
\begin{align*}
\triangle E - ce& \ \sin(\triangle E- se \ (\cos(\triangle E)-1)=n \triangle t, \\
x= \triangle E &- n \triangle t,
\end{align*}

eta beraz,
\begin{equation*}
x-ce \sin(n\triangle t+x)-se(cos(n \triangle t+x)-1)=0.
\end{equation*}

Honako baliokidetasun trigonometrikoak ordezkatuz,
\begin{align*}
& \cos(A+B) =\cos(A)\cos(B)-\sin(A)\cos(B),\\
& \sin(A+b) =\cos(A)\sin(B)+\sin(A)\cos(B),
\end{align*}
berdintza hau lortzen dugu,
\begin{multline*}
x- (se \ \cos(n \triangle t)+ ce \ \sin(n \triangle t)) \cos(x) \\
    + (se \ \sin(n \triangle t)-ce \ \cos(n \triangle t)) \sin(x)+se =0.
\end{multline*}

\paragraph*{}$x$ txikia dela suposatuz, honako hurbilpenak ordezkatuko dugu,
\begin{equation*}
x \approx \sin(x), \ \cos(x) \approx 1- \frac{x^2}{2}
\end{equation*}

eta honako berdintza lortuko dugu,
\begin{multline*}
(se \ \cos(n \triangle t)+ce \ \sin(n \triangle t)) \frac{x^2}{2} \\
+ (1+se \ \sin(n \triangle t)-ce \cos(n \triangle t))x-(se )=0.
\end{multline*}

\paragraph*{} Azkenik, goiko ekuazio hau askatuz ($Ax^2+Bx+C=0 \ \rightarrow x={-B\pm \sqrt{B^2-4AC}}/{2A}$) lortuko dugu,
\begin{equation*}
\triangle E^{[0]}=x+n\triangle t.
\end{equation*}

\paragraph*{Koordenatu kartesiarren} kalkulua ekuazio hauen bidez egingo dugu,

\begin{equation*}
(q_1,v_1)=(q_0,v_0)+ (q_0,v_0) \left(\begin{array}{cc}
                                       b_{11} & b_{12} \\
                                       b_{21} & b_{22} \\
                                \end{array}\right)
\end{equation*}

\begin{align*}
b_{11} &=(C-1) \frac{a}{\|q\|}, \\
b_{21} &=\triangle t+(S-\triangle E) \frac{a^{\frac{3}{2}}}{\mu^{\frac{1}{2}}} \\
b_{12} &=\frac{s}{\|q\| \sqrt{a} (1-ce \ C +se \ S)}, \\
b_{22} &=\frac{C-1}{1-ce \ C+ se \ S}. 
\end{align*}

Non osagai bakoitzaren definizioa,
\begin{align*}
C &=\cos(\triangle E), \ S=\sin(\triangle E), \\
ce &=e \ \cos(E_0) = \|q\| \|v\|^2-1, \\
se &= e \ \sin(E_0)=\frac{(q \cdot v)}{\sqrt{\mu \ a}}, \\
a &= \frac{\mu \|q\|}{2\mu-\|q\|\|v\|^2}, \\
n &= \frac{\mu^{\frac{1}{2}}}{a^{\frac{3}{2}}}.
\end{align*}

\paragraph*{Ezabapen arazoa.} $\triangle E$ txikia denean, $\cos(\triangle E)-1$ espresioaren kalkuluaren ezabapen arazoak biribiltze errore handia eragin dezake. Hori konpontzeko baliokidetasun trigonometriko hau erabiliko dugu,
\begin{equation*}
\cos(\triangle E)-1=-\frac{(\sin^2(\triangle E)}{1+\cos(\triangle E)}.
\end{equation*}  

Eta beraz, Keplerren ekuazioak hauek izango dira,
\begin{equation*}
f(\triangle E)=\triangle E - ce \sin(\triangle E)+ se \bigg(\frac{(\sin^2(\triangle E)}{1+\cos(\triangle E)}\bigg)-n \triangle t=0
\end{equation*}

Eta $(q_1,v_1)$ balioak kalkulatzeko,
\begin{equation*}
b_{11}=(C-1) \frac{a}{\|q\|}, \longrightarrow b_{11}=-\frac{(\sin^2(\triangle E)}{1+\cos(\triangle E)} \frac{a}{\|q\|}
\end{equation*}

\section{Koordenatu sistemak.}
\label{erans:A2}

\subsection*{Sarrera.}

Lehenik koordenatu barizentrikoei $q_i, p_i \in \mathbb{R}^3, \ i=0,\dots,N$ dagokien Hamiltondarra gogoratuko dugu,
\begin{equation}
H(q,p)=\frac{1}{2}\ \sum^N_{i=0}{\ \frac{{\|p_i\|}^2}{m_i}}-G\ \sum^N_{0\le i<j\le N}{\frac{m_im_j}{\|q_i-q_j\|}}.
\end{equation}

\subsection*{Koordenatu Heliozentrikoak.}

Koordenatu barizentrikoetatik abiatuta eta aldagai aldaketa bat aplikatuz ekuazio koordenatu heliozentrikoen $Q_i,P_i \in \mathbb{R}^3, \ i=0,\dots,N$ 
arabera berridatziko ditugu. 

\subsubsection*{Aldagai aldaketa.}
Lehenik honako aldagai aldaketa aplikatuko dugu,
\begin{align*}
Q_0 &=q_0, \ \ Q_i=q_i-q_0, \\ 
P_0 &=\sum\limits_{i=0}^{N}p_i, \ \ P_i=p_i, \ \ i=1,\dots{,N}.
\end{align*}

Hamiltondarra era honetan deskonposatu daiteke
\begin{equation*}
H=H_K+T_1+U_1.
\end{equation*}

\begin{enumerate}
\item $H_K$.
\begin{equation*}
H_K=\sum\limits_{i=1}^{N}\bigg(\frac{\|P_i\|^2}{2 \mu_i} -\frac{G m_0 m_i}{\|Q_i\|}\bigg), \ \ \mu_i=\frac{m_0m_i}{(m_0+m_i)}.
\end{equation*} 

\item $T_1$.
\begin{equation*}
T_1=\frac{1}{m_0} \left(\sum\limits_{0<i<j\le N}^{N} P_i\ P_j \right).
\end{equation*}

\item $U_1$.
\begin{equation*}
U_1= -\sum\limits_{0< i<j\le N}^{N} \frac{G m_i m_j}{\|Q_i-Q_j\|}.
\end{equation*}
\end{enumerate}

\subsubsection*{Ekuazio diferentzialak.}

\paragraph*{}Hamiltondar bakoitza independienteki kontsideratuta dagokio ekuazio diferentzialak lortzen ditugu:
\begin{enumerate}
\item $H_K$.
\begin{align*}
&\dot{Q_i} = \triangledown_p H_k \ \ \Rightarrow \ \  \dot{Q_i}=P_i\left(\frac{m_0+m_i}{m_0m_i}\right), \\
&\dot{P_i} = -\triangledown_q H_k \ \ \Rightarrow \ \  \dot{P_i}= - \frac{G m_0m_i}{\|Q_i\|^3 }\ Q_i, \ \ i=1,\dots, N.
\end{align*}

\item $T_1$.
\begin{align*}
&\dot{Q_i} = \triangledown_p T_1 \ \ \Rightarrow \ \  \dot{Q_i}=\sum\limits_{j\ne i,\ j=1}^{N} \frac{P_i}{m_0}, \\
&\dot{P_i} = -\triangledown_q T_1 \ \ \Rightarrow \ \  \dot{P_i}= 0, \ \ i=1,\dots, N.
\end{align*}

\item $U_1$.
\begin{align*}
&\dot{Q_i} = \triangledown_p U_1 \ \ \Rightarrow \ \  \dot{Q_i}=0, \\
&\dot{P_i} = -\triangledown_q U_1 \ \ \Rightarrow \ \ 
 \dot{P_i}= \sum\limits_{j \ne i , \ j=1}^{N} \bigg(\frac{-Gm_im_j}{\|Q_i-Q_j\|^3} \ (Q_i-Q_j) \bigg), \ \ i=1,\dots, N.
\end{align*}

\end{enumerate}

\paragraph*{}Azkenik, $V_i=P_i/\mu_i$ aplikatuta integrazioan erabiliko ditugun ekuazioak laburtuko ditugu.
\begin{enumerate}
\item $H_k$.
\begin{align*}
\dot{Q_i} &=V_i \\
\dot{V_i} &= - \frac{G(m_0+m_i)}{\|Q_i\|^3 }\ Q_i,  \ \ i=1,\dots, N.
\end{align*}

\item $T_1$.
\begin{align*}
\dot{Q_i} &=\sum\limits_{j\ne i,\ j=1}^{N} \frac{V_j \ m_j}{(m_0+m_j)}, \\ 
\dot{V_i} &= 0, \ \ i=1,\dots, N.
\end{align*}

\item $U_1$.
\begin{align*}
\dot{Q_i} &=0, \\ 
\dot{V_i} &= - \frac{G(m_0+m_i)}{m_0}
                    \sum\limits_{j \ne i , \ j=1}^{N} \bigg( \frac{m_j}{\|Q_i-Q_j\|^3} (Q_i-Q_j)     \bigg), \ \ i=1,\dots, N.
\end{align*}

\end{enumerate}

\subsubsection*{Energia.}

Koordenatu heliozentrikoetan integrazioak egiten ditugunean, sistemaren energia kalkulatzeko, soluzioa koordenatu barizentrikoetara bihurtuko dugu .  Hauek dira koordenatu heliozentrikoetatik abiatuta ($Q_i,V_i$) , koordenatu barizentrikoak ($q_i,v_i$) kalkulatzeko ekuazioak,

\begin{enumerate}

\item $q_i, \ \ i=0,\dots,N$. 
\begin{align*}
q_0 &=-\sum\limits_{i=1}^{M} \frac{m_i Q_i}{M}, \ \ M= \sum\limits_{i=0}^{N} m_i, \\
q_i &=q_0+Q_i, \ \ i=1,\dots,N.
\end{align*}

\item $v_i, \ \ i=0,\dots,N$. 
\begin{align*}
v_i &=\frac{m_0}{m_0+m_i} \ V_i, \ \ i=1,\dots,N \\
P_0 &=\sum\limits_{i=0}^{N} p_i=\sum\limits_{i=0}^{N} m_i v_i=0 \Rightarrow \ \  m_0v_0+ \sum\limits_{i=1}^{N} m_i v_i=0 \Rightarrow v_0=-\frac{1}{m_0} \sum\limits_{i=1}^{N} m_i v_i. 
\end{align*}

\end{enumerate}


\subsection*{Koordenatu Jacobiarrak.}

Koordenatu barizentrikoetatik abiatuta eta aldagai aldaketa bat aplikatuz ekuazioak koordenatu Jacobiarren  $Q_i,P_i \in \mathbb{R}^3, \ i=0,\dots,N$ arabera berridatziko ditugu. 

\subsubsection*{Aldagai aldaketa.}
Lehenik honako aldagai aldaketa aplikatuko dugu,
\begin{align*}
Q_0 &=(m_0 q_0+\cdots+m_n q_n)/\eta_N,\ \ \ Q_i  =q_i-\left(\sum_{j=0}^{i-1}m_j q_j \right)/\eta_{i-1} \\
P_0 &=\sum\limits_{i=0}^{N}p_i, \ \ \ P_i =\left(\eta_{i-1} \ p_i- m_i \sum_{j=0}^{i-1} p_j\right)/\eta_i, \ \ \ \ i=1,\dots{,N}.
\end{align*}
non $\eta_i=\sum_{j=0}^{i} m_j$ den.

\paragraph*{}Era berean, jacobi masak $m'_i=(\eta_{i-1} m_i)/\eta_i$ eta $\mu'_i=m_i \eta_{i-1}$ ekuazioetan ordezkatuko ditugu. Hamiltondarra era honetan deskonposatu daiteke,
\begin{equation*}
H=H_K+H_I.
\end{equation*} 

\begin{enumerate}
\item $H_K$.
\begin{equation*}
H_K=\sum\limits_{i=1}^{N}\bigg(\frac{\|P_i\|^2}{2 m'_i} -\frac{\mu'_i}{\|Q_i\|}\bigg).
\end{equation*} 
\item $H_I$.
\begin{equation*}
H_I=\left(\frac{\mu'_i}{Q_i}-\frac{Gm_0m_i}{q_i} \right) -\sum\limits_{0< i<j\le N}^{N} \frac{G m_i m_j}{\|Q_i-Q_j\|}.
\end{equation*} 
\end{enumerate} 

\section{Newton eraginkorraren garapena.}
\label{erans:A3}

Formulazio estandarrean honako ekuazio sistema askatzeko metodoa proposatzen da,
\begin{equation}
\label{eqA3:1}
(I_s \otimes I_d- h \ A \otimes J) \triangle Y =r.
\end{equation}

Lehenengo modu orokorrean eta ondoren, metodoa simetrikoa dela kontutan harturik garapenaren zehaztasunak emango ditugu.

\subsection*{Kasu orokorra}
\label{serans:A31}

Honako ekuazio sistemari,
\begin{align}
\label{eqA3:2}
(I_s \otimes I_d- h \ \bar{A} \otimes J) \ \Delta Y - \frac{1}{2}(e_s \otimes I_d) \ \Delta z =r,\\
(-h e_s^T B \otimes J) \ \Delta Y+  \Delta z=0,
\end{align}

aldagai aldaketa hau,  aplikatuko doigu.
\begin{equation}
\label{eqA3:3}
 \triangle Y = (Q \otimes I_d) \ W.
\end{equation}

\begin{enumerate}

\item Lehen urratsa.

Ekuazioa sistemaren lehen ekuazioari (\ref{eqA3:2}), aldagai aldaketa (\ref{eqA3:3}) aplikatu eta $(Q^{-1} \otimes I_d)$ gaia ezkerretik biderkatuz,
\begin{multline*}
(Q^{-1} \otimes I_d) \ (I_s \otimes I_d- h \ \bar{A} \otimes J) \ (Q \otimes I_d) \ W \\
  - (Q^{-1} \otimes I_d) \ (\frac{1}{2} \ e_s \otimes I_d) \Delta z = (Q^{-1} \otimes I_d) r.
\end{multline*}

Eta garatuz,
\begin{multline*}
(I_s \otimes I_d- h Q^{-1} \bar{A} Q \otimes J) \ W 
- \frac{1}{2}(Q^{-1}  e_s \otimes I_d) \Delta z = (Q^{-1} \otimes I_d) r.
\end{multline*}

\item Bigarren urratsa.

Metodoa simetrikoa bada,
\begin{equation}
\label{eq:DD}
Q^{-1} \bar A  Q = 
\left(
\begin{matrix}
0 & D \\
-D^T & 0 
\end{matrix}
\right)
\end{equation}

eta beraz,
\begin{multline*}
(I_s \otimes I_d- h
\left(
\begin{matrix}
0 & D \\
-D^T & 0 
\end{matrix}  
\right) \otimes J) \ W 
- \frac{1}{2}(Q^{-1}  e_s \otimes I_d) \Delta z = (Q^{-1} \otimes I_d) r.
\end{multline*}

Eta $I_s \otimes I_d$ bloke moduan idatzia,
\begin{equation}
\label{eq:xx}
I_s \otimes I_d =
\left(
\begin{matrix}
I_m \otimes I_d & 0 \\
0  & I_{s-m} \otimes I_d 
\end{matrix}
\right)
\end{equation}

\begin{multline*}
\left(
\begin{matrix}
I_m \otimes I_d & \ \ -h D \otimes J \\
hD^T \otimes J &  \ \ I_{s-m} \otimes I_d 
\end{matrix}
\right)
 W- \frac{1}{2}(Q^{-1}  e_s \otimes I_d) \Delta z = (Q^{-1} \otimes I_d) r.
\end{multline*}

\item Hirugarren urratsa.

Bigarren ekuazioari (\ref{eqA3:2}) aldagai aldaketa (\ref{eqA3:3}) aplikatuz,
\begin{equation*}
(- h e_s^T B \otimes J) (Q \otimes I_d) W + \Delta z =0, 
\end{equation*}

eta garatuz,
\begin{equation*}
- h (e_s^T 
B \ Q \otimes J) W +\Delta z =0.
\end{equation*}

\end{enumerate}

\subsection*{Kasu simetrikoa}
\label{serans:A32}

Kasu orokorraren emaitzan, kasu simetrikoa ordezkatuz 
\begin{align*}
W=\left(
\begin{matrix}
W^{`} \\
W^{``} 
\end{matrix}
\right), \ \ Q=(Q_1 \ \ Q_2)
\end{align*}

dagokion ekuazioak lortuko ditugu ekuazioak.

Honako berdintza hauek kontutan hartuz, $Q^{-1}=Q^TB, \ \ es^TBQ_2=0, \ \ Q_2^TBes=0$ honako ekuazioak lortuko ditugu,
\begin{align*}
 W^{'}-h \ (D \otimes J) \ W^{''} -\frac{1}{2}\ (Q_1^T B \ e_s \otimes I_d) \ \Delta z &= (Q_1^T B \otimes I_d) \ r,\\
 h \ (D^T \otimes J) \ W^{'}+W^{''} &= (Q_2^T B \otimes I_d) \ r, \\
  - h \ (e_s^T B \ Q_1 \otimes J) \ W^{'} + \Delta z &=0. 
\end{align*}




